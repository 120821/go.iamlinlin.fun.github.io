---
layout: post
title: "postgres--导出数据"
date: "2022-07-18"
categories: 
---
<p>查看docker的id</p>

{% highlight %}
{% highlight %}sudo docker ps -a

CONTAINER ID&nbsp;&nbsp; IMAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PORTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NAMES

0404f4be99a2&nbsp;&nbsp; postgres:14.2&nbsp;&nbsp; &quot;docker-entrypoint.s&hellip;&quot;&nbsp;&nbsp; 5 weeks ago&nbsp;&nbsp;&nbsp; Up 5 weeks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 127.0.0.1:5432-&gt;5432/tcp&nbsp;&nbsp;&nbsp;&nbsp; keen_kilby

3f1d593f54d2&nbsp;&nbsp; postgres:14.2&nbsp;&nbsp; &quot;docker-entrypoint.s&hellip;&quot;&nbsp;&nbsp; 5 weeks ago&nbsp;&nbsp;&nbsp; Exited (1) 5 weeks ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; objective_bhaskara

29b06cdf3b26&nbsp;&nbsp; mongo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;docker-entrypoint.s&hellip;&quot;&nbsp;&nbsp; 5 weeks ago&nbsp;&nbsp;&nbsp; Up 5 weeks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 127.0.0.1:27017-&gt;27017/tcp&nbsp;&nbsp; dreamy_darwin

c8eb7b3234d6&nbsp;&nbsp; postgres:14.2&nbsp;&nbsp; &quot;docker-entrypoint.s&hellip;&quot;&nbsp;&nbsp; 5 weeks ago&nbsp;&nbsp;&nbsp; Exited (0) 5 weeks ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vigorous_curie

a1d96b0835f4&nbsp;&nbsp; postgres:14.2&nbsp;&nbsp; &quot;docker-entrypoint.s&hellip;&quot;&nbsp;&nbsp; 2 months ago&nbsp;&nbsp; Exited (0) 5 weeks ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wizardly_joliot

75204b0a6b92&nbsp;&nbsp; mongo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;docker-entrypoint.s&hellip;&quot;&nbsp;&nbsp; 3 months ago&nbsp;&nbsp; Exited (0) 5 weeks ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sharp_bardeen{% endhighlight %}
{% endhighlight %}

<p>进入目标bash</p>

{% highlight %}
{% highlight %}ubuntu@VM-0-13-ubuntu:/opt/app/lueluelue-admin/releases/20220528173100$ sudo docker exec -it 0404 bash

root@0404f4be99a2:/# ls -altrh

total 84K

drwxr-xr-x&nbsp;&nbsp; 2 root root 4.0K Mar 19 13:46 home

drwxr-xr-x&nbsp;&nbsp; 2 root root 4.0K Mar 19 13:46 boot

drwxr-xr-x&nbsp;&nbsp; 1 root root 4.0K Apr 18 00:00 var

drwxr-xr-x&nbsp;&nbsp; 1 root root 4.0K Apr 18 00:00 usr{% endhighlight %}

<p>进入数据库</p>

{% highlight %}
{% highlight %}root@0404f4be99a2:/# su postgres

postgres@0404f4be99a2:/$ pg_d

pg_dropcluster&nbsp; pg_dump&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pg_dumpall&nbsp;&nbsp;

postgres@0404f4be99a2:/$ pg_dump --username=postgres --dbname=lueluelue --host=localhost &gt; 20220718.sql

bash: 20220718.sql: Permission denied

postgres@0404f4be99a2:/$ ls

bin&nbsp; boot&nbsp; dev&nbsp;&nbsp; &nbsp;docker-entrypoint-initdb.d&nbsp; etc&nbsp; home&nbsp; lib&nbsp; lib64&nbsp; media&nbsp; mnt&nbsp; opt&nbsp; proc&nbsp; root&nbsp;&nbsp; &nbsp;run&nbsp; sbin&nbsp; srv&nbsp;&nbsp; &nbsp;sys&nbsp; tmp&nbsp; usr&nbsp; var

postgres@0404f4be99a2:/$ ls -al

total 84

drwxr-xr-x&nbsp;&nbsp; 1 root root 4096 Jun&nbsp; 6 08:41 .

drwxr-xr-x&nbsp;&nbsp; 1 root root 4096 Jun&nbsp; 6 08:41 ..

drwxr-xr-x&nbsp;&nbsp; 2 root root 4096 Apr 18 00:00 bin

drwxr-xr-x&nbsp;&nbsp; 2 root root 4096 Mar 19 13:46 boot{% endhighlight %}

<p>导出数据</p>

<p>{% highlight %}postgres@0404f4be99a2:/$ pg_dump --username=postgres --dbname=lueluelue --host=localhost &gt; /tmp/20220718.sql<br />
postgres@0404f4be99a2:/$ ls -al /tmp/<br />
total 105220<br />
drwxrwxrwt 1 root&nbsp;&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096 Jul 18 02:20 .<br />
drwxr-xr-x 1 root&nbsp;&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096 Jun&nbsp; 6 08:41 ..<br />
-rw-r--r-- 1 postgres postgres 107733080 Jul 18 02:20 20220718.sql{% endhighlight %}</p>

<p>复制到当前目录下</p>

{% highlight %}
{% highlight %}sudo docker cp 0404:/tmp/20220718.sql .

ubuntu@VM-0-13-ubuntu:/opt/app/lueluelue-admin/releases/20220528173100$ ls

&quot;&#39;&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Gemfile.lock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asdf-mongodb.ERUv&nbsp;&nbsp; config&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dot_env.example&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nohup.out&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; scripts&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmp

&#39;&#39;\&#39;&#39;=&#39;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; README.md&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asdf-mongodb.ibN4&nbsp;&nbsp; config.ru&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dump.rdb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; package-lock.json&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; spec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmp2

&nbsp;20220428-042348.archive&nbsp;&nbsp; Rakefile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asdf-mongodb.qc6n&nbsp;&nbsp; data_graph_account_siwei-2&nbsp;&nbsp; invalid_domains.json&nbsp;&nbsp; package.json&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; swagger&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmp3

&nbsp;20220718.sql&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; app&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; babel.config.js&nbsp;&nbsp;&nbsp;&nbsp; db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; postcss.config.js&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; temp.cookie&nbsp;&nbsp; vendor

&nbsp;Capfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asdf-mongodb.1AqM&nbsp;&nbsp; bin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; docker-compose.yml&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; test&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yarn.lock

&nbsp;Gemfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; asdf-mongodb.4erD&nbsp;&nbsp; claims.json&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domains.json&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% endhighlight %}

<p>scp到远程</p>

{% highlight %}
{% highlight %}scp ubuntu@api-rpc.lueluelue.link:/opt/app/lueluelue-admin/releases/20220528173100/20220718.sql /workspace/lueluelue-backend-rails/20220718.sql

20220718.sql&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 100%&nbsp; 103MB 120.7KB/s&nbsp;&nbsp; 14:31{% endhighlight %}

<p>&nbsp;</p>

