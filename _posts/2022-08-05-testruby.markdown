---
layout: post
title: "test  部署 ruby社区"
date: "2022-08-05"
categories: 
---
<p>https://guides.rubyonrails.org/configuring.html#configuring-a-database</p>

<p>首先，下载代码：</p>

<p>使用源代码 <a class="notion-link-token notion-enable-hover" data-reactroot="" data-token-index="1" href="https://github.com/better-web-org/homeland" rel="noopener noreferrer" style="cursor:pointer;color:inherit;word-wrap:break-word;text-decoration:inherit" target="_blank"><span class="link-annotation-unknown-block-id--1758472415" style="border-bottom:0.05em solid;border-color:rgba(55,53,47,0.4);opacity:0.7">https://github.com/better-web-org/homeland</span></a></p>

<p>git clone&nbsp;</p>

<p>明确这是一个非常典型的rails 应用。</p>

<blockquote>
<ol>
	<li>git clone 代码到本地</li>
	<li>修改数据库config/database.yml</li>
	<li>gem install bundler （注意版本)</li>
	<li>bundle install</li>
	<li>bundle execrails s</li>
</ol>

<p>（肯定会报错的，因为需要 redis , 安装好之后， 重复4，5 步）</p>
</blockquote>

<p>bundle的版本在 Gemfile.lock最下边看到</p>

<p>bundle -v 进行查看版本是否一致</p>

<p>配置数据库</p>

<pre>
<code>default: &amp;default

&nbsp; adapter: postgresql（使用psql）

&nbsp; pool: &lt;%= ENV[&quot;DATABASE_POOL&quot;] || 64 %&gt;

&nbsp; timeout: 5000

&nbsp; encoding: utf8

&nbsp; pool: 5

&nbsp; username: admin（用户以及密码）

&nbsp; user: admin

&nbsp; password: 88888888

&nbsp; port: 5432

&nbsp; host: localhost（设置为本地的URL）</code></pre>

<p>不设置host就会报错</p>

<p>然后设置</p>

<pre>
<code>linlin@linlin-i5:/workspace/homeland$ cat config/puma.rb

threads_count = ENV.fetch(&quot;RAILS_MAX_THREADS&quot;, 5)

threads threads_count, threads_count

port ENV.fetch(&quot;PORT&quot;, 3344)（设置为需要的端口，3000就报错了）

environment ENV.fetch(&quot;RAILS_ENV&quot;, &quot;development&quot;)

workers ENV.fetch(&quot;WEB_CONCURRENCY&quot;, 2)

preload_app!</code>

<code>plugin :tmp_restart</code></pre>

<p>然后 bundle exec rake db:create</p>

<p>bundle exec rake db:migrate</p>

<p>重启rails</p>

<p><img height="1080" src="/uploads/ckeditor/pictures/166/image-20220805175545-1.png" width="1920" /></p>

<p>遇到的错误，以及进行的调整：</p>

<p>linlin@linlin-i5:/workspace/homeland$ grep 5433 . -r &gt; /tmp/5433<br />
linlin@linlin-i5:/workspace/homeland$ vim /tmp/5433<br />
linlin@linlin-i5:/workspace/homeland$ vim .env<br />
linlin@linlin-i5:/workspace/homeland$ bundle exec rake db:create<br />
WARNING: table: &quot;settings&quot; does not exist or not database connection, `Setting.app_name` fallback to returns the default value.<br />
WARNING: table: &quot;settings&quot; does not exist or not database connection, `Setting.rack_attack` fallback to returns the default value.<br />
WARNING: table: &quot;settings&quot; does not exist or not database connection, `Setting.rack_attack` fallback to returns the default value.<br />
Created database &#39;homeland-dev&#39;<br />
Created database &#39;homeland-test&#39;<br />
linlin@linlin-i5:/workspace/homeland$ bundle exec rake db:migrate<br />
WARNING: table: &quot;settings&quot; does not exist or not database connection, `Setting.app_name` fallback to returns the default value.<br />
WARNING: table: &quot;settings&quot; does not exist or not database connection, `Setting.rack_attack` fallback to returns the default value.<br />
WARNING: table: &quot;settings&quot; does not exist or not database connection, `Setting.rack_attack` fallback to returns the default value.<br />
== 20160117061547 InitPgDb: migrating =========================================<br />
-- create_table(&quot;authorizations&quot;, {:force=&gt;:cascade, :id=&gt;:integer})<br />
&nbsp;&nbsp; -&gt; 0.0054s<br />
-- add_index(&quot;authorizations&quot;, [&quot;provider&quot;, &quot;uid&quot;], {:name=&gt;&quot;index_authorizations_on_provider_and_uid&quot;, :using=&gt;:btree})<br />
&nbsp;&nbsp; -&gt; 0.0020s</p>

<p>&nbsp;</p>

<p>&nbsp;</p>

<hr />
