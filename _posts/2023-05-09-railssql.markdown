---
layout: post
title: "rails  sql将数据按照某一列合并"
date: "2023-05-09"
categories: 
---
<p>refer： <a href="https://stackoverflow.com/questions/28146848/how-can-i-use-group-concat-in-rails">https://stackoverflow.com/questions/28146848/how-can-i-use-group-concat-in-rails</a></p>

<p>Rails 中没有group_concat等价物，但您可以使用包含来做到这一点：</p>

<pre>
<code>continents = Continents
  .joins(:countries, :event_locations)
  .includes(:countries)
  .group(&quot;continents.code&quot;)

continents.each do |continent| 
  continent.countries.join(&quot;,&quot;)
end</code></pre>

<p>这将只产生 2 个查询 - 我知道，不如一个查询好，但我认为这比 Rails 没有&ldquo;group_concat&rdquo;所能做的最好。另一种方式是这样的：</p>

<pre>
<code>Country
  .select(&quot;countries.id, GROUP_CONCAT(countries.name) as grouped_name&quot;)
  .joins(:continents, :event_locations)
  .group(&quot;continents.code&quot;)</code></pre>

<p>但是，如果这样做，则需要根据数据库供应商进行更改。</p>

<ul>
	<li><strong>MySQL</strong>: group_concat(countries.name)</li>
	<li><strong>PostgreSQL</strong>: string_agg(countries.name, &#39;,&#39;)</li>
	<li><strong>Oracle</strong>: listagg(countries.name, &#39;,&#39;)</li>
</ul>

<p>&nbsp;</p>

