---
layout: post
title: "react 下载CSV 处理二维数组"
date: "2023-11-12"
categories: 
---
<p>在下载CSV的时候，对于二维数组，可以这样进行处理：</p>

<p>例如接口的数据有多个二维数组，其中有：</p>

<pre>
<code><span style="color:#abe338">&quot;production&quot;</span>:[
        [
            <span style="color:#abe338">&quot;&quot;</span>,
            <span style="color:#abe338">&quot;R888&quot;</span>
        ],
        [
            <span style="color:#abe338">&quot;2022&quot;</span>,
            <span style="color:#abe338">&quot;0&quot;</span>
        ],
        [
            <span style="color:#abe338">&quot;2023&quot;</span>,
            <span style="color:#abe338">&quot;0&quot;</span>
        ],
        [
            <span style="color:#abe338">&quot;2024&quot;</span>,
            <span style="color:#abe338">&quot;0&quot;</span>
        ]
    ],
</code></pre>

<p>可以写函数：</p>

<pre>
<code>function processProduction(csvContent, productionData) {
  csvContent += &#39;内销产量(production) \n&#39;;

  for (let i = 1; i &lt; productionData.length; i++) {
    const [year, value] = productionData[i];
    csvContent += `${year},${value}\n`;
  }

  return csvContent;
}
</code>然后调用：
</pre>

<pre>
<code>const params = details.map((item) =&gt; item.params);
const results = details.map((item) =&gt; item.results);

let csvContent = &#39;年份,初始库存量,总排放\n&#39;;

for (let i = 0; i &lt; params.length; i++) {
  const parsedParams = JSON.parse(params[i]);
  const parsedResults = JSON.parse(results[i]);
  const resultsArray = Array.isArray(parsedResults) ? parsedResults : [];

  const dataArray = resultsArray.map((result) =&gt; {
    return Object.values(result);
  });

  const year = 2010 + i;

  dataArray.forEach((data) =&gt; {
    csvContent += `${year},${data.join(&#39;,&#39;)}\n`;
  });

  if (parsedParams?.consumption) {
    csvContent = processProperty(csvContent, &#39;消费量(consumption)&#39;, parsedParams.consumption);
  }

  if (parsedParams?.production) {
    csvContent = processProduction(csvContent, parsedParams.production);
  }
}
</code></pre>

